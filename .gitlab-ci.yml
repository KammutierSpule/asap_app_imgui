stages:
  - build

variables:
  GIT_SUBMODULE_STRATEGY: recursive
  BUILD_TYPE: Release

.build_template: &build_definition
  stage: build
  script:
    #
    # Build Folder
    #
    - mkdir _build
    - cd _build

    #
    # Run the build
    #
    - cmake -DCMAKE_BUILD_TYPE=$BUILD_TYPE -DBUILD_SHARED_LIBS=ON -DOPTION_SELF_CONTAINED=ON -DCMAKE_INSTALL_PREFIX=./asap-install ..
    - make -j 2
    - make install
    - ctest -C $BUILD_TYPE --output-on-failure

build:ubuntu:latest:
  <<: *build_definition
  image: ubuntu:latest
  before_script:
    - apt-get update -qq
    - apt-get install -y -qq libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev libgl-dev
